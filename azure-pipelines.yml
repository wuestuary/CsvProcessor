trigger:
  - main

pool:
  vmImage: 'macOS-14'

variables:
  buildConfiguration: 'Release'

steps:
- task: UseDotNet@2
  inputs:
    version: '8.0.x'  # 使用 .NET 8

- script: |
    dotnet publish CsvProcessor.csproj \
      -f net8.0-maccatalyst17.5 \
      -c $(buildConfiguration) \
      -p:EnableCodeSigning=false \
      -p:EnablePackageSigning=false \
      -p:CreatePackage=true \
      -p:SelfContained=true \
      -p:PublishTrimmed=true \
      -p:TrimMode=partial \
      -p:OutputPath=./output \
      -bl  # 添加二进制日志
  displayName: 'Build macOS App'

- script: |
    echo "=== 输出目录内容 ==="
    ls -la ./output
    du -sh ./output/*
    
    echo "=== 查找 .app ==="
    find ./output -name "*.app" -type d
    
    echo "=== 查找 .pkg ==="
    find ./output -name "*.pkg"
  displayName: 'Check Output'

- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: './output'
    artifactName: 'macOS-App'