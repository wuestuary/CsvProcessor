using UIKit;using Foundation;namespace CsvProcessor.Platforms.MacCatalyst;public class FileDropView : UIView, IUIDropInteractionDelegate{    const string FileUrlUti = "public.file-url";    public Action<string>? OnFileDropped;    public FileDropView()    {        AddInteraction(new UIDropInteraction(this));    }    public bool CanHandleSession(        UIDropInteraction interaction,        IUIDropSession session)    {        // MAUI 下没有 HasItemsConformingTo，只能这样判断        return session.Items?.Length > 0;    }    public UIDropProposal SessionDidUpdate(        UIDropInteraction interaction,        IUIDropSession session)    {        // 🎨 拖入高亮        BackgroundColor = UIColor.SystemBlue.ColorWithAlpha(0.15f);        return new UIDropProposal(UIDropOperation.Copy);    }    public void PerformDrop(        UIDropInteraction interaction,        IUIDropSession session)    {        if (session.Items == null)            return;        foreach (var item in session.Items)        {            item.ItemProvider.LoadItem(                FileUrlUti,                null,                (data, error) =>                {                    try                    {                        if (data is not NSUrl url || !url.IsFileUrl)                            return;                        var path = url.Path;                        if (string.IsNullOrEmpty(path))                            return;                        // ❌ 非 CSV 拒绝                        if (!path.EndsWith(".csv", StringComparison.OrdinalIgnoreCase))                            return;                        OnFileDropped?.Invoke(path);                    }                    finally                    {                        InvokeOnMainThread(() =>                        {                            BackgroundColor = UIColor.Clear;                        });                    }                });        }    }}