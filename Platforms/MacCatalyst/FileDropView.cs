using UIKit;using Foundation;using UniformTypeIdentifiers;namespace CsvProcessor.Platforms.MacCatalyst;public class FileDropView : UIView, IUIDropInteractionDelegate{    public Action<string>? OnFileDropped;    public FileDropView()    {        var dropInteraction = new UIDropInteraction(this);        AddInteraction(dropInteraction);    }    public bool CanHandleSession(UIDropInteraction interaction, IUIDropSession session)    {        return session.HasItemsConformingTo(new[]        {            UTType.FileUrl.Identifier        });    }    public UIDropProposal SessionDidUpdate(        UIDropInteraction interaction,        IUIDropSession session)    {            // 拖入高亮    BackgroundColor = UIColor.SystemBlue.ColorWithAlpha(0.15f);        return new UIDropProposal(UIDropOperation.Copy);    }public void PerformDrop(    UIDropInteraction interaction,    IUIDropSession session){    foreach (var item in session.Items)    {        item.ItemProvider.LoadItem(            UTType.FileUrl.Identifier,            null,            (data, error) =>            {                try                {                    if (data is not NSUrl url || !url.IsFileUrl)                        return;                    var path = url.Path;                    // ❌ 非 CSV 直接拒绝                    if (!path.EndsWith(".csv", StringComparison.OrdinalIgnoreCase))                        return;                    // ✅ 合法 CSV                    OnFileDropped?.Invoke(path);                }                finally                {                    // 🧹 拖放完成后取消高亮                    InvokeOnMainThread(() =>                    {                        BackgroundColor = UIColor.Clear;                    });                }            });    }}}